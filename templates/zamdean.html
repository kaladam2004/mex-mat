<!DOCTYPE html>
<html lang="tg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú—É–æ–≤–∏–Ω–∏ –î–µ–∫–∞–Ω ‚Äî –°–∏—Å—Ç–µ–º–∞–∏ –ò–¥–æ—Ä–∞–∫—É–Ω”£</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#07090f;--s1:#0d1117;--s2:#141b24;--s3:#1a2332;
  --br:#1e2d3d;--br2:#243447;
  --text:#dde3ee;--muted:#5c7a99;--muted2:#3d5470;
  --blue:#3b82f6;--blue2:#1d6fd8;--purple:#a855f7;--purple2:#7c22d9;
  --green:#22c55e;--red:#ef4444;--orange:#f59e0b;--cyan:#06b6d4;
  --sw:300px;
}
body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex}
/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sb{width:var(--sw);min-height:100vh;background:var(--s1);border-right:1px solid var(--br);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100}
.sb-logo{padding:20px 18px 16px;border-bottom:1px solid var(--br);display:flex;align-items:center;gap:11px}
.sb-icon{width:38px;height:38px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.sb-brand{font-size:13px;font-weight:700;color:var(--text);line-height:1.3}
.sb-brand span{display:block;font-size:11px;font-weight:400;color:var(--muted);margin-top:1px}
.sb-user{padding:14px 18px;border-bottom:1px solid var(--br);display:flex;align-items:center;gap:11px}
.sb-avatar{width:38px;height:38px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:#fff;flex-shrink:0}
.sb-uname{font-size:13px;font-weight:600;line-height:1.3}
.sb-badge{display:inline-block;font-size:10px;font-weight:600;color:var(--purple);background:rgba(168,85,247,.12);border:1px solid rgba(168,85,247,.2);padding:1px 8px;border-radius:20px;margin-top:3px}
.sb-fac{display:inline-block;font-size:10px;color:var(--cyan);background:rgba(6,182,212,.1);padding:1px 8px;border-radius:20px;margin-top:2px}
.sb-nav{flex:1;padding:10px 8px;overflow-y:auto}
.nav-sec{font-size:10px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:.08em;padding:10px 12px 4px}
.nav-it{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;color:var(--muted);border-left:2px solid transparent;transition:all .18s;margin-bottom:1px;text-decoration:none;background:none;border:none;width:100%}
.nav-it:hover{background:rgba(255,255,255,.04);color:var(--text)}
.nav-it.active{background:rgba(59,130,246,.1);color:var(--blue);border-left:2px solid var(--blue)}
.nav-it svg{width:16px;height:16px;flex-shrink:0}
.sb-foot{padding:12px 8px;border-top:1px solid var(--br)}
.sb-foot a{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:8px;font-size:13px;font-weight:500;color:var(--muted);text-decoration:none;transition:all .18s}
.sb-foot a:hover{color:var(--text);background:rgba(255,255,255,.04)}
.sb-foot a.logout{color:var(--red)}
.sb-foot a.logout:hover{background:rgba(239,68,68,.08)}
/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main{margin-left:var(--sw);flex:1;display:flex;flex-direction:column}
.topbar{height:54px;background:var(--s1);border-bottom:1px solid var(--br);display:flex;align-items:center;padding:0 24px;gap:12px;position:sticky;top:0;z-index:50}
.topbar-title{font-size:15px;font-weight:700;flex:1}
.topbar-badge{background:rgba(168,85,247,.12);border:1px solid rgba(168,85,247,.2);color:var(--purple);font-size:11px;font-weight:600;padding:3px 12px;border-radius:20px}
.content{padding:22px 24px;flex:1}
.page{display:none;animation:fadeIn .2s ease}
.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:none}}
/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.stats-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;margin-bottom:22px}
.sc{background:var(--s1);border:1px solid var(--br);border-radius:13px;padding:16px;position:relative;overflow:hidden}
.sc::after{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.sc.blue::after{background:linear-gradient(90deg,var(--blue2),var(--blue))}
.sc.purple::after{background:linear-gradient(90deg,var(--purple2),var(--purple))}
.sc.green::after{background:linear-gradient(90deg,#16a34a,var(--green))}
.sc.orange::after{background:linear-gradient(90deg,#d97706,var(--orange))}
.sc.red::after{background:linear-gradient(90deg,#dc2626,var(--red))}
.sc.cyan::after{background:linear-gradient(90deg,#0891b2,var(--cyan))}
.sc-icon{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;margin-bottom:10px}
.sc.blue .sc-icon{background:rgba(59,130,246,.12);color:var(--blue)}
.sc.purple .sc-icon{background:rgba(168,85,247,.12);color:var(--purple)}
.sc.green .sc-icon{background:rgba(34,197,94,.12);color:var(--green)}
.sc.orange .sc-icon{background:rgba(245,158,11,.12);color:var(--orange)}
.sc.red .sc-icon{background:rgba(239,68,68,.12);color:var(--red)}
.sc.cyan .sc-icon{background:rgba(6,182,212,.12);color:var(--cyan)}
.sc-icon svg{width:16px;height:16px}
.sc-val{font-family:'JetBrains Mono',monospace;font-size:26px;font-weight:700;color:var(--text);line-height:1}
.sc-lbl{font-size:11px;color:var(--muted);margin-top:5px;font-weight:500}
/* ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ */
.panel{background:var(--s1);border:1px solid var(--br);border-radius:13px;overflow:hidden;margin-bottom:18px}
.ph{padding:13px 18px;border-bottom:1px solid var(--br);display:flex;align-items:center;justify-content:space-between;gap:10px}
.ph h3{font-size:14px;font-weight:700;margin:0;display:flex;align-items:center;gap:7px}
.ph h3 svg{width:15px;height:15px;color:var(--blue);flex-shrink:0}
.pb{padding:18px}
/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{padding:7px 16px;border-radius:8px;border:none;font-size:12px;font-weight:700;font-family:'Manrope',sans-serif;cursor:pointer;display:inline-flex;align-items:center;gap:5px;transition:all .18s}
.btn svg{width:13px;height:13px;flex-shrink:0}
.btn-blue{background:var(--blue);color:#fff}
.btn-blue:hover{background:var(--blue2)}
.btn-ghost{background:transparent;border:1px solid var(--br2);color:var(--muted);font-size:12px}
.btn-ghost:hover{border-color:var(--blue);color:var(--blue);background:rgba(59,130,246,.06)}
.btn-red{background:rgba(239,68,68,.1);color:#fca5a5;border:1px solid rgba(239,68,68,.2)}
.btn-red:hover{background:rgba(239,68,68,.18)}
.btn-green{background:rgba(34,197,94,.1);color:#86efac;border:1px solid rgba(34,197,94,.2)}
.btn-green:hover{background:rgba(34,197,94,.18)}
.btn-sm{padding:4px 10px;font-size:11px}
/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.fg{margin-bottom:12px}
.fg label{display:block;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:5px}
.finp{width:100%;padding:9px 12px;background:var(--s2);border:1.5px solid var(--br2);border-radius:9px;color:var(--text);font-size:13px;font-family:'Manrope',sans-serif;outline:none;transition:border-color .18s}
.finp:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(59,130,246,.08)}
.finp::placeholder{color:var(--muted2)}
select.finp option{background:var(--s2)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:12px}
/* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
.filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:center}
.filters .finp{width:auto;min-width:130px;flex:1;max-width:200px}
/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
thead tr{border-bottom:1px solid var(--br2)}
th{padding:9px 12px;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;text-align:left;white-space:nowrap}
td{padding:10px 12px;border-bottom:1px solid var(--br);vertical-align:middle}
tr:last-child td{border-bottom:none}
tbody tr:hover td{background:rgba(255,255,255,.018)}
.act-row{display:flex;gap:5px;align-items:center}
/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;white-space:nowrap}
.b-active{background:rgba(34,197,94,.1);color:var(--green)}
.b-inactive{background:rgba(100,116,139,.1);color:var(--muted)}
.b-shift1{background:rgba(59,130,246,.1);color:#93c5fd}
.b-shift2{background:rgba(168,85,247,.1);color:#c4b5fd}
.b-nb-ok{background:rgba(34,197,94,.08);color:var(--green)}
.b-nb-mid{background:rgba(245,158,11,.1);color:#fde68a}
.b-nb-high{background:rgba(239,68,68,.1);color:#fca5a5}
/* ‚îÄ‚îÄ STUDENT ROW ‚îÄ‚îÄ */
.srow{display:flex;align-items:center;gap:12px;padding:11px 16px;border-bottom:1px solid var(--br);cursor:pointer;transition:background .15s}
.srow:hover{background:rgba(255,255,255,.025)}
.srow:last-child{border-bottom:none}
.sav{width:36px;height:36px;border-radius:50%;background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0}
.sdetail{flex:1;min-width:0}
.sn{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sm{font-size:11px;color:var(--muted);margin-top:1px}
/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.moverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:1000;align-items:center;justify-content:center}
.moverlay.open{display:flex}
.mbox{background:var(--s1);border:1px solid var(--br2);border-radius:16px;padding:26px;width:500px;max-width:95vw;max-height:90vh;overflow-y:auto}
.mbox-sm{width:420px}
.mtitle{font-size:15px;font-weight:800;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}
.mclose{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1;padding:0}
.mclose:hover{color:var(--text)}
/* ‚îÄ‚îÄ ALERT / WARNING ‚îÄ‚îÄ */
.alert-box{border-radius:10px;padding:12px 16px;font-size:12px;margin-bottom:16px;display:flex;align-items:flex-start;gap:9px}
.alert-box svg{width:16px;height:16px;flex-shrink:0;margin-top:1px}
.alert-warn{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);color:#fde68a}
.alert-info{background:rgba(59,130,246,.07);border:1px solid rgba(59,130,246,.2);color:#93c5fd}
.alert-red{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.2);color:#fca5a5}
/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-card{display:grid;grid-template-columns:1fr 1fr;gap:18px;max-width:760px}
/* ‚îÄ‚îÄ COURSE STATS ‚îÄ‚îÄ */
.cstat-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--br)}
.cstat-row:last-child{border-bottom:none}
/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.loading{display:flex;align-items:center;gap:10px;color:var(--muted);font-size:13px;padding:20px}
.spinner{width:16px;height:16px;border:2px solid var(--br2);border-top-color:var(--blue);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:44px 16px;color:var(--muted)}
.empty svg{width:36px;height:36px;margin:0 auto 10px;display:block;opacity:.2}
.empty p{font-size:13px}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-thumb{background:var(--br2);border-radius:3px}
/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast-wrap{position:fixed;bottom:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--s2);border:1px solid var(--br2);border-radius:11px;padding:11px 18px;font-size:13px;font-weight:500;display:flex;align-items:center;gap:9px;box-shadow:0 8px 32px rgba(0,0,0,.5);animation:tIn .25s ease;max-width:340px}
@keyframes tIn{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:none}}
.toast.succ{border-left:3px solid var(--green)}
.toast.err{border-left:3px solid var(--red)}
.toast.warn{border-left:3px solid var(--orange)}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê -->
<aside class="sb">
  <div class="sb-logo">
    <div class="sb-icon">üèõ</div>
    <div class="sb-brand">–ú—É–æ–≤–∏–Ω–∏ –î–µ–∫–∞–Ω<span>–°–∏—Å—Ç–µ–º–∞–∏ –∏–¥–æ—Ä–∞–∫—É–Ω”£</span></div>
  </div>
  <div class="sb-user">
    <div class="sb-avatar" id="sbAv">–ú</div>
    <div>
      <div class="sb-uname" id="sbName">{{ user.full_name if user else "–ö–æ—Ä–±–∞—Ä" }}</div>
      <span class="sb-badge">–ú—É–æ–≤–∏–Ω–∏ –î–µ–∫–∞–Ω</span>
      {% if faculty %}<br><span class="sb-fac">{{ faculty.name }}</span>{% endif %}
    </div>
  </div>
  <nav class="sb-nav">
    <div class="nav-sec">–ê—Å–æ—Å”£</div>
    <button class="nav-it active" data-page="overview">
      <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/></svg>
      –£–º—É–º”£
    </button>
    <button class="nav-it" data-page="groups">
      <svg viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/></svg>
      –ì—É—Ä”Ø“≥“≥–æ
    </button>
    <button class="nav-it" data-page="students">
      <svg viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/></svg>
      –î–æ–Ω–∏—à“∑”Ø—ë–Ω
    </button>
    <button class="nav-it" data-page="highnb">
      <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l6.516 11.592c.75 1.335-.213 2.99-1.742 2.99H3.483c-1.53 0-2.492-1.655-1.743-2.99L8.257 3.1zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-2a1 1 0 01-1-1V7a1 1 0 112 0v3a1 1 0 01-1 1z" clip-rule="evenodd"/></svg>
      –ù–ë –±–∞–ª–∞–Ω–¥
    </button>
    <button class="nav-it" data-page="consec">
      <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/></svg>
      “í–∞–π–±–∞—Ç–∏ –ø–∞–∏ “≥–∞–º
    </button>
    <div class="nav-sec">–ò–¥–æ—Ä–∞–∫—É–Ω”£</div>
    <button class="nav-it" data-page="curators">
      <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
      –ö—É—Ä–∞—Ç–æ—Ä–æ–Ω
    </button>
    <button class="nav-it" data-page="addGroup">
      <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/></svg>
      –ì—É—Ä”Ø“≥ –∏–ª–æ–≤–∞
    </button>
    <div class="nav-sec">“≤–∏—Å–æ–±</div>
    <button class="nav-it" data-page="profile">
      <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
      –ü—Ä–æ—Ñ–∏–ª–∏ –º–∞–Ω
    </button>
  </nav>
  <div class="sb-foot">
    <a href="/vice-dean/change-password">
      <svg viewBox="0 0 20 20" fill="currentColor" style="width:15px;height:15px"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
      –ò–≤–∞–∑ –∫–∞—Ä–¥–∞–Ω–∏ –ø–∞—Ä–æ–ª
    </a>
    <a href="/logout" class="logout">
      <svg viewBox="0 0 20 20" fill="currentColor" style="width:15px;height:15px"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/></svg>
      –ë–∞—Ä–æ–º–∞–¥–∞–Ω
    </a>
  </div>
</aside>

<!-- ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê -->
<main class="main">
  <div class="topbar">
    <div class="topbar-title" id="pgTitle">–£–º—É–º”£</div>
    <span class="topbar-badge">–ú—É–æ–≤–∏–Ω–∏ –î–µ–∫–∞–Ω</span>
  </div>
  <div class="content">

    <!-- ‚ïê‚ïê‚ïê PAGE: OVERVIEW ‚ïê‚ïê‚ïê -->
    <div class="page active" id="page-overview">
      <div class="stats-row" id="oStatsRow">
        <div class="sc blue"><div class="sc-icon"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/></svg></div><div class="sc-val" id="oStudents">‚Äî</div><div class="sc-lbl">–î–æ–Ω–∏—à“∑”Ø—ë–Ω</div></div>
        <div class="sc purple"><div class="sc-icon"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/></svg></div><div class="sc-val" id="oGroups">‚Äî</div><div class="sc-lbl">“∂–∞–º—ä–∏ –≥—É—Ä”Ø“≥“≥–æ</div></div>
        <div class="sc green"><div class="sc-icon"><svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg></div><div class="sc-val" id="oActive">‚Äî</div><div class="sc-lbl">–ì—É—Ä”Ø“≥“≥–æ–∏ —Ñ–∞—ä–æ–ª</div></div>
        <div class="sc cyan"><div class="sc-icon"><svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg></div><div class="sc-val" id="oCurators">‚Äî</div><div class="sc-lbl">–ö—É—Ä–∞—Ç–æ—Ä–æ–Ω</div></div>
        <div class="sc red"><div class="sc-icon"><svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l6.516 11.592c.75 1.335-.213 2.99-1.742 2.99H3.483c-1.53 0-2.492-1.655-1.743-2.99L8.257 3.1zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-2a1 1 0 01-1-1V7a1 1 0 112 0v3a1 1 0 01-1 1z" clip-rule="evenodd"/></svg></div><div class="sc-val" id="oHighNb">‚Äî</div><div class="sc-lbl">–ù–ë –±–∞–ª–∞–Ω–¥</div></div>
      </div>
      <div class="panel">
        <div class="ph"><h3><svg viewBox="0 0 20 20" fill="currentColor"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/></svg>–û–º–æ—Ä –∞–∑ —Ä”Ø–∏ –∫—É—Ä—Å</h3></div>
        <div class="pb" id="oCourseStats"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: GROUPS ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-groups">
      <div class="panel">
        <div class="ph">
          <h3><svg viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/></svg>–†”Ø–π—Ö–∞—Ç–∏ –≥—É—Ä”Ø“≥“≥–æ</h3>
          <button class="btn btn-blue btn-sm" onclick="openAddGroup()">
            <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/></svg>
            –ì—É—Ä”Ø“≥ –∏–ª–æ–≤–∞
          </button>
        </div>
        <div class="tw">
          <table>
            <thead><tr><th>#</th><th>–ì—É—Ä”Ø“≥</th><th>–ö—É—Ä—Å</th><th>–ù–∞–≤–±–∞—Ç</th><th>–ö—É—Ä–∞—Ç–æ—Ä</th><th>–ù–∞—Ñ–∞—Ä</th><th>“≤–æ–ª–∞—Ç</th><th>–ê–º–∞–ª</th></tr></thead>
            <tbody id="groupsBody"><tr><td colspan="8"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: STUDENTS ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-students">
      <div class="panel">
        <div class="ph">
          <h3><svg viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0z"/></svg>–†”Ø–π—Ö–∞—Ç–∏ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω</h3>
        </div>
        <div class="pb" style="padding-bottom:0">
          <div class="filters">
            <input type="search" class="finp" id="stuSearch" placeholder="üîç “∂—É—Å—Ç—É“∑”Ø –∞–∑ —Ä”Ø–∏ –§–ò–û...">
            <select class="finp" id="stuCourse" onchange="loadStudents()">
              <option value="">“≤–∞–º–∞–∏ –∫—É—Ä—Å“≥–æ</option>
              <option value="1">1-–∫—É—Ä—Å</option>
              <option value="2">2-–∫—É—Ä—Å</option>
              <option value="3">3-–∫—É—Ä—Å</option>
              <option value="4">4-–∫—É—Ä—Å</option>
            </select>
            <select class="finp" id="stuGroup" onchange="loadStudents()">
              <option value="">“≤–∞–º–∞–∏ –≥—É—Ä”Ø“≥“≥–æ</option>
            </select>
          </div>
        </div>
        <div id="stuList"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: HIGH NB ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-highnb">
      <div class="alert-box alert-red" style="margin-bottom:18px">
        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l6.516 11.592c.75 1.335-.213 2.99-1.742 2.99H3.483c-1.53 0-2.492-1.655-1.743-2.99L8.257 3.1zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-2a1 1 0 01-1-1V7a1 1 0 112 0v3a1 1 0 01-1 1z" clip-rule="evenodd"/></svg>
        <span>–î–æ–Ω–∏—à“∑”Ø—ë–Ω–µ –∫–∏ –∑–∏—ë–¥–∞ –∞–∑ <strong id="nbLimLabel">35</strong> —Å–æ–∞—Ç –ù–ë –¥–æ—Ä–∞–Ω–¥. –§–∞“õ–∞—Ç –î–µ–∫–∞–Ω –º–µ—Ç–∞–≤–æ–Ω–∞–¥ –ù–ë-—Ä–æ —Å–∞–±–∞–±–Ω–æ–∫ –∫—É–Ω–∞–¥.</span>
      </div>
      <div class="panel">
        <div class="ph"><h3>–ù–ë –±–∞–ª–∞–Ω–¥ ‚Äî –†”Ø–π—Ö–∞—Ç</h3><span id="highNbCount" style="font-size:12px;color:var(--muted)"></span></div>
        <div class="tw">
          <table>
            <thead><tr><th>#</th><th>–ù–æ–º –≤–∞ –Ω–∞—Å–∞–±</th><th>–ì—É—Ä”Ø“≥</th><th>–ö—É—Ä—Å</th><th>–ù–ë</th><th>–í–æ–ª–∏–¥–∞–π–Ω</th></tr></thead>
            <tbody id="highNbBody"><tr><td colspan="6"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: CONSECUTIVE ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-consec">
      <div class="alert-box alert-warn" style="margin-bottom:18px">
        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l6.516 11.592c.75 1.335-.213 2.99-1.742 2.99H3.483c-1.53 0-2.492-1.655-1.743-2.99L8.257 3.1zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-2a1 1 0 01-1-1V7a1 1 0 112 0v3a1 1 0 01-1 1z" clip-rule="evenodd"/></svg>
        <span>–î–æ–Ω–∏—à“∑”Ø—ë–Ω–µ –∫–∏ <strong id="consDaysLabel">5</strong> —Ä”Ø–∑ –≤–∞ –∑–∏—ë–¥–∞ –ø–∞–∏ “≥–∞–º –¥–∞—Ä –¥–∞—Ä—Å –∏—à—Ç–∏—Ä–æ–∫ –Ω–∞–∫–∞—Ä–¥–∞–∞–Ω–¥.</span>
      </div>
      <div class="panel">
        <div class="ph"><h3>“í–∞–π–±–∞—Ç–∏ –ø–∞–∏ “≥–∞–º</h3></div>
        <div class="tw">
          <table>
            <thead><tr><th>#</th><th>–ù–æ–º –≤–∞ –Ω–∞—Å–∞–±</th><th>–ì—É—Ä”Ø“≥</th><th>–ù–ë —É–º—É–º”£</th></tr></thead>
            <tbody id="consecBody"><tr><td colspan="4"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: CURATORS ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-curators">
      <div class="panel">
        <div class="ph">
          <h3><svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>–ö—É—Ä–∞—Ç–æ—Ä–æ–Ω</h3>
          <button class="btn btn-blue btn-sm" onclick="openCurModal(null)">
            <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/></svg>
            –ö—É—Ä–∞—Ç–æ—Ä –∏–ª–æ–≤–∞
          </button>
        </div>
        <div class="tw">
          <table>
            <thead><tr><th>#</th><th>–ù–æ–º –≤–∞ –Ω–∞—Å–∞–±</th><th>–Æ–∑–µ—Ä–Ω–µ–π–º</th><th>–ì—É—Ä”Ø“≥</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ö–∞—Ñ–µ–¥—Ä–∞</th><th>–ê–º–∞–ª</th></tr></thead>
            <tbody id="curatorsBody"><tr><td colspan="7"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: ADD GROUP ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-addGroup">
      <div class="panel" style="max-width:540px">
        <div class="ph"><h3>–ì—É—Ä”Ø“≥ –∏–ª–æ–≤–∞ / —Ç–∞“≥—Ä–∏—Ä</h3></div>
        <div class="pb">
          <input type="hidden" id="editGroupId">
          <div class="frow">
            <div class="fg"><label>–ù–æ–º–∏ –≥—É—Ä”Ø“≥ *</label><input type="text" class="finp" id="grpNumber" placeholder="–º–∞—Å–∞–ª–∞–Ω: –ú–ê-101"></div>
            <div class="fg"><label>–ù–∞–≤–±–∞—Ç *</label>
              <select class="finp" id="grpShift"><option value="1">1-–Ω–∞–≤–±–∞—Ç (—Å—É–±“≥)</option><option value="2">2-–Ω–∞–≤–±–∞—Ç (—à–æ–º)</option></select>
            </div>
          </div>
          <div class="frow">
            <div class="fg"><label>–ö—É—Ä—Å *</label><select class="finp" id="grpCourse"></select></div>
            <div class="fg"><label>–ö—É—Ä–∞—Ç–æ—Ä</label><select class="finp" id="grpCurator"><option value="">‚Äî –ò–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥ ‚Äî</option></select></div>
          </div>
          <div style="display:flex;gap:10px;margin-top:6px">
            <button class="btn btn-blue" onclick="submitGroup()">
              <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
              –°–∞–±—Ç –∫—É–Ω–µ–¥
            </button>
            <button class="btn btn-ghost" onclick="resetGroupForm()">–¢–æ–∑–∞ –∫—É–Ω–µ–¥</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PAGE: PROFILE ‚ïê‚ïê‚ïê -->
    <div class="page" id="page-profile">
      <div class="profile-card">
        <div class="panel">
          <div class="ph"><h3>–ú–∞—ä–ª—É–º–æ—Ç–∏ —à–∞—Ö—Å”£</h3></div>
          <div class="pb">
            <form onsubmit="saveProfile(event)">
              <div class="fg"><label>–ù–æ–º—É –Ω–∞—Å–∞–±</label><input class="finp" id="pName" required></div>
              <div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input class="finp" id="pPhone"></div>
              <div class="fg"><label>Gmail</label><input type="email" class="finp" id="pEmail"></div>
              <div class="fg"><label>–ö–∞—Ñ–µ–¥—Ä–∞</label><input class="finp" id="pDept"></div>
              <div class="fg"><label>–°–æ–ª–∏ —Ç–∞–≤–∞–ª–ª—É–¥</label><input type="number" class="finp" id="pBirth" min="1950" max="2005"></div>
              <button type="submit" class="btn btn-blue" style="width:100%">–°–∞–±—Ç –∫–∞—Ä–¥–∞–Ω</button>
            </form>
          </div>
        </div>
        <div class="panel">
          <div class="ph"><h3>–ò–≤–∞–∑ –∫–∞—Ä–¥–∞–Ω–∏ –ø–∞—Ä–æ–ª</h3></div>
          <div class="pb">
            <form action="/vice-dean/change-password" method="post">
              <div class="fg">
                <label>–ü–∞—Ä–æ–ª–∏ –Ω–∞–≤ (6 —Ä–∞“õ–∞–º)</label>
                <input type="password" class="finp" name="new_password" maxlength="6" pattern="\d{6}" required style="letter-spacing:8px;font-size:22px;font-family:'JetBrains Mono',monospace">
              </div>
              <button type="submit" class="btn btn-blue" style="width:100%">–ò–≤–∞–∑ –∫–∞—Ä–¥–∞–Ω</button>
            </form>
            <div class="alert-box alert-info" style="margin-top:14px">
              <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>
              <span>–ü–∞—Ä–æ–ª: 6 —Ä–∞“õ–∞–º, “≥–∞–º–∞–∏ —è–∫—Ö–µ–ª–∞ –Ω–∞–±–æ—à–∞–Ω–¥</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- ‚ïê‚ïê‚ïê MODAL: CURATOR ‚ïê‚ïê‚ïê -->
<div class="moverlay" id="mCurator">
  <div class="mbox mbox-sm">
    <div class="mtitle">
      <span id="mCurTitle">–ö—É—Ä–∞—Ç–æ—Ä –∏–ª–æ–≤–∞ –∫—É–Ω–µ–¥</span>
      <button class="mclose" onclick="closeModal('mCurator')">&times;</button>
    </div>
    <input type="hidden" id="mCurId">
    <div class="fg"><label>–ù–æ–º—É –Ω–∞—Å–∞–± *</label><input class="finp" id="mCurName" placeholder="–ù–æ–º—É –Ω–∞—Å–∞–±"></div>
    <div class="fg" id="mCurUGroup"><label>–Æ–∑–µ—Ä–Ω–µ–π–º *</label><input class="finp" id="mCurUser" placeholder="username"></div>
    <div class="fg"><label>–ö–∞—Ñ–µ–¥—Ä–∞</label><input class="finp" id="mCurDept" placeholder="–ö–∞—Ñ–µ–¥—Ä–∞"></div>
    <div class="frow">
      <div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input class="finp" id="mCurPhone" placeholder="+992..."></div>
      <div class="fg"><label>Email</label><input type="email" class="finp" id="mCurEmail" placeholder="email@..."></div>
    </div>
    <div class="alert-box alert-info" id="mCurPwdNote" style="margin-bottom:14px">
      <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
      <span>–ü–∞—Ä–æ–ª–∏ –∞–≤–≤–∞–ª–∏—è: <strong style="color:var(--text);font-family:'JetBrains Mono',monospace">020304</strong></span>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn btn-ghost" onclick="closeModal('mCurator')">–ë–µ–∫–æ—Ä</button>
      <button class="btn btn-blue" onclick="submitCurator()">–°–∞–±—Ç –∫—É–Ω–µ–¥</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê MODAL: GROUP (inline add) ‚ïê‚ïê‚ïê -->
<div class="moverlay" id="mGroup">
  <div class="mbox mbox-sm">
    <div class="mtitle">
      <span id="mGrpTitle">–ì—É—Ä”Ø“≥ –∏–ª–æ–≤–∞ –∫—É–Ω–µ–¥</span>
      <button class="mclose" onclick="closeModal('mGroup')">&times;</button>
    </div>
    <input type="hidden" id="mGrpId">
    <div class="frow">
      <div class="fg"><label>–ù–æ–º–∏ –≥—É—Ä”Ø“≥ *</label><input class="finp" id="mGrpNumber" placeholder="–ú–ê-101"></div>
      <div class="fg"><label>–ù–∞–≤–±–∞—Ç *</label>
        <select class="finp" id="mGrpShift"><option value="1">1-–Ω–∞–≤–±–∞—Ç</option><option value="2">2-–Ω–∞–≤–±–∞—Ç</option></select>
      </div>
    </div>
    <div class="frow">
      <div class="fg"><label>–ö—É—Ä—Å *</label><select class="finp" id="mGrpCourse"></select></div>
      <div class="fg"><label>–ö—É—Ä–∞—Ç–æ—Ä</label><select class="finp" id="mGrpCurator"><option value="">‚Äî ‚Äî</option></select></div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
      <button class="btn btn-ghost" onclick="closeModal('mGroup')">–ë–µ–∫–æ—Ä</button>
      <button class="btn btn-blue" onclick="submitGroupModal()">–°–∞–±—Ç</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê MODAL: STUDENT DETAIL ‚ïê‚ïê‚ïê -->
<div class="moverlay" id="mStudent">
  <div class="mbox">
    <div class="mtitle">
      <span>–ü—Ä–æ—Ñ–∏–ª–∏ –¥–æ–Ω–∏—à“∑”Ø</span>
      <button class="mclose" onclick="closeModal('mStudent')">&times;</button>
    </div>
    <div id="mStuContent"></div>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<script>
'use strict';
// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
const $ = id => document.getElementById(id);
const $$ = s => document.querySelectorAll(s);
const PAGES = {
  overview:'–£–º—É–º”£', groups:'–ì—É—Ä”Ø“≥“≥–æ', students:'–î–æ–Ω–∏—à“∑”Ø—ë–Ω',
  highnb:'–ù–ë –±–∞–ª–∞–Ω–¥', consec:'“í–∞–π–±–∞—Ç–∏ –ø–∞–∏ “≥–∞–º',
  curators:'–ö—É—Ä–∞—Ç–æ—Ä–æ–Ω', addGroup:'–ì—É—Ä”Ø“≥ –∏–ª–æ–≤–∞', profile:'–ü—Ä–æ—Ñ–∏–ª–∏ –º–∞–Ω'
};

function toast(msg, type='succ') {
  const w=$('toastWrap');
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  const icons={succ:'‚úì',err:'‚úï',warn:'‚ö†'};
  el.innerHTML=`<span style="font-size:15px;font-weight:800">${icons[type]||'i'}</span> ${msg}`;
  w.appendChild(el);
  setTimeout(()=>el.remove(),3400);
}

function nbBadge(n,lim=35) {
  if(n===0) return `<span class="badge b-nb-ok">0 –ù–ë</span>`;
  if(n<lim) return `<span class="badge b-nb-mid">${n} –ù–ë</span>`;
  return `<span class="badge b-nb-high">${n} –ù–ë</span>`;
}

function emptyRow(cols,msg) {
  return `<tr><td colspan="${cols}"><div class="empty"><svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg><p>${msg}</p></div></td></tr>`;
}

function loadingRow(cols) {
  return `<tr><td colspan="${cols}"><div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div></td></tr>`;
}

async function apiFetch(url) {
  const r = await fetch(url);
  if(!r.ok) throw new Error(`HTTP ${r.status}`);
  return r.json();
}

async function apiPost(url, body, method='POST') {
  const isFormData = body instanceof FormData;
  const r = await fetch(url, {
    method,
    body,
    headers: isFormData ? {} : {'Content-Type':'application/json'}
  });
  const data = await r.json().catch(()=>({}));
  if(!r.ok) throw new Error(data.detail || `HTTP ${r.status}`);
  return data;
}

function openModal(id) { $(id).classList.add('open'); }
function closeModal(id) { $(id).classList.remove('open'); }

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function showPage(name) {
  $$('.page').forEach(p=>p.classList.remove('active'));
  $$('.nav-it').forEach(n=>n.classList.remove('active'));
  $(`page-${name}`)?.classList.add('active');
  const btn = document.querySelector(`.nav-it[data-page="${name}"]`);
  if(btn) btn.classList.add('active');
  $('pgTitle').textContent = PAGES[name] || '';
  const loaders = {
    overview: loadOverview, groups: loadGroups, students: initStudents,
    highnb: loadHighNb, consec: loadConsec, curators: loadCurators,
    addGroup: initAddGroup, profile: loadProfile
  };
  loaders[name]?.();
}

$$('.nav-it').forEach(btn => {
  btn.addEventListener('click', () => { const p=btn.dataset.page; if(p) showPage(p); });
});

// ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ
async function loadOverview() {
  try {
    const d = await apiFetch('/vice-dean/api/stats/overview');
    $('oStudents').textContent = d.total_students;
    $('oGroups').textContent   = d.total_groups;
    $('oActive').textContent   = d.active_groups;
    $('oCurators').textContent = d.total_curators;
    $('oHighNb').textContent   = d.high_absence_students;
    if($('nbLimLabel')) $('nbLimLabel').textContent = d.nb_limit;
    if($('consDaysLabel')) $('consDaysLabel').textContent = d.consecutive_days;

    if(d.course_stats?.length) {
      $('oCourseStats').innerHTML = d.course_stats.map(c=>`
        <div class="cstat-row">
          <span style="font-weight:600">üìö ${c.year}-–∫—É—Ä—Å</span>
          <div style="display:flex;gap:18px;font-size:12px;color:var(--muted)">
            <span>${c.groups} –≥—É—Ä”Ø“≥</span>
            <strong style="color:var(--text);font-size:14px;font-family:'JetBrains Mono',monospace">${c.students}</strong>
          </div>
        </div>`).join('');
    } else {
      $('oCourseStats').innerHTML='<p style="color:var(--muted);text-align:center;padding:18px;font-size:13px">–ú–∞—ä–ª—É–º–æ—Ç –Ω–µ—Å—Ç</p>';
    }
  } catch(e) { toast('–•–∞—Ç–æ–≥–∏–∏ –æ–º–æ—Ä','err'); }
}

// ‚îÄ‚îÄ GROUPS ‚îÄ‚îÄ
async function loadGroups() {
  $('groupsBody').innerHTML = loadingRow(8);
  try {
    const groups = await apiFetch('/vice-dean/api/groups');
    if(!groups.length){ $('groupsBody').innerHTML=emptyRow(8,'–ì—É—Ä”Ø“≥ —ë—Ñ—Ç –Ω–∞—à—É–¥'); return; }
    $('groupsBody').innerHTML = groups.map((g,i)=>`<tr>
      <td style="color:var(--muted);font-size:11px;font-family:'JetBrains Mono',monospace">${i+1}</td>
      <td style="font-weight:700">${g.number}</td>
      <td>${g.course_year||'‚Äî'}-–∫—É—Ä—Å</td>
      <td><span class="badge b-shift${g.shift}">${g.shift}-–Ω–∞–≤–±–∞—Ç</span></td>
      <td style="font-size:12px">${g.curator||`<span style="color:var(--muted)">‚Äî</span>`}</td>
      <td style="font-family:'JetBrains Mono',monospace;font-weight:600">${g.total_students}</td>
      <td><span class="badge ${g.is_active?'b-active':'b-inactive'}">${g.is_active?'‚óè –§–∞—ä–æ–ª':'‚óã “í–∞–π—Ä–∏—Ñ–∞—ä–æ–ª'}</span></td>
      <td><div class="act-row">
        <button class="btn btn-ghost btn-sm" onclick="editGroup(${g.id})" title="–¢–∞“≥—Ä–∏—Ä">‚úèÔ∏è</button>
        <button class="btn btn-sm ${g.is_active?'btn-red':'btn-green'}" onclick="toggleGroup(${g.id},${g.is_active})" title="${g.is_active?'“í–∞–π—Ä–∏—Ñ–∞—ä–æ–ª':'–§–∞—ä–æ–ª'}">${g.is_active?'‚è∏':'‚ñ∂'}</button>
      </div></td>
    </tr>`).join('');
  } catch(e) { toast('–•–∞—Ç–æ–≥”£','err'); }
}

function openAddGroup() { showPage('addGroup'); }

async function editGroup(id) {
  try {
    const g = await apiFetch(`/vice-dean/api/groups/${id}`);
    await initAddGroup();
    $('editGroupId').value = g.id;
    $('grpNumber').value = g.number;
    $('grpShift').value = g.shift;
    $('grpCourse').value = g.course_id;
    $('grpCurator').value = g.curator_id||'';
    showPage('addGroup');
  } catch(e) { toast('–•–∞—Ç–æ–≥”£','err'); }
}

async function toggleGroup(id, current) {
  try {
    await fetch(`/vice-dean/api/groups/${id}/toggle-active`, {method:'PATCH'});
    toast(current?'–ì—É—Ä”Ø“≥ “ì–∞–π—Ä–∏—Ñ–∞—ä–æ–ª —à—É–¥':'–ì—É—Ä”Ø“≥ —Ñ–∞—ä–æ–ª —à—É–¥');
    loadGroups();
  } catch(e) { toast('–•–∞—Ç–æ–≥”£','err'); }
}

let _courses=[], _curators=[];
async function initAddGroup() {
  try {
    [_courses, _curators] = await Promise.all([
      apiFetch('/vice-dean/api/courses'),
      apiFetch('/vice-dean/api/curators')
    ]);
    $('grpCourse').innerHTML = _courses.map(c=>`<option value="${c.id}">${c.year}-–∫—É—Ä—Å</option>`).join('');
    $('grpCurator').innerHTML = '<option value="">‚Äî –ö—É—Ä–∞—Ç–æ—Ä –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥ ‚Äî</option>' +
      _curators.map(c=>`<option value="${c.id}">${c.full_name}</option>`).join('');
  } catch(e){}
}

function resetGroupForm() {
  $('editGroupId').value=''; $('grpNumber').value=''; $('grpShift').value='1';
}

async function submitGroup() {
  const id=$('editGroupId').value;
  const fd=new FormData();
  fd.append('number',$('grpNumber').value.trim());
  fd.append('shift',$('grpShift').value);
  fd.append('course_id',$('grpCourse').value);
  if($('grpCurator').value) fd.append('curator_id',$('grpCurator').value);
  if(!fd.get('number')){ toast('–ù–æ–º–∏ –≥—É—Ä”Ø“≥—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥','err'); return; }
  try {
    if(id){
      await apiPost(`/vice-dean/api/groups/${id}`,fd,'PUT');
      toast('–ì—É—Ä”Ø“≥ —Å–∞–±—Ç —à—É–¥');
    } else {
      await apiPost('/vice-dean/api/groups',fd);
      toast('–ì—É—Ä”Ø“≥ –∏–ª–æ–≤–∞ —à—É–¥');
    }
    resetGroupForm();
    showPage('groups');
  } catch(e){ toast(e.message,'err'); }
}

// ‚îÄ‚îÄ STUDENTS ‚îÄ‚îÄ
let stuTimer=null;
async function initStudents() {
  // Populate group dropdown
  try {
    const groups = await apiFetch('/vice-dean/api/groups');
    $('stuGroup').innerHTML = '<option value="">“≤–∞–º–∞–∏ –≥—É—Ä”Ø“≥“≥–æ</option>' +
      groups.map(g=>`<option value="${g.id}">${g.number}</option>`).join('');
  } catch(e){}
  loadStudents();
  $('stuSearch').oninput = () => { clearTimeout(stuTimer); stuTimer=setTimeout(loadStudents,350); };
}

async function loadStudents() {
  $('stuList').innerHTML='<div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div>';
  const search=$('stuSearch').value.trim();
  const course=$('stuCourse').value;
  const group=$('stuGroup').value;
  try {
    let url='/vice-dean/api/students?';
    if(search.length>=2) url+=`search=${encodeURIComponent(search)}&`;
    if(course) url+=`course_year=${course}&`;
    if(group) url+=`group_id=${group}&`;
    const students = await apiFetch(url);
    if(!students.length){ $('stuList').innerHTML='<div class="empty" style="padding:40px"><svg viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0z"/></svg><p>–î–æ–Ω–∏—à“∑”Ø —ë—Ñ—Ç –Ω–∞—à—É–¥</p></div>'; return; }
    $('stuList').innerHTML = students.map(s=>`
      <div class="srow" onclick="openStudent(${s.id})">
        <div class="sav" style="background:${s.is_high_risk?'rgba(239,68,68,.15)':'var(--s2)'};color:${s.is_high_risk?'var(--red)':'var(--text)'}">${s.full_name.charAt(0)}</div>
        <div class="sdetail">
          <div class="sn">${s.full_name}</div>
          <div class="sm">${s.group_number||'‚Äî'} &bull; ${s.course_year||'?'}-–∫—É—Ä—Å${s.birth_place?' &bull; '+s.birth_place:''}</div>
        </div>
        ${nbBadge(s.total_absences)}
      </div>
    `).join('');
  } catch(e){ toast('–•–∞—Ç–æ–≥”£','err'); }
}

async function openStudent(id) {
  openModal('mStudent');
  $('mStuContent').innerHTML='<div class="loading"><div class="spinner"></div>–ë–æ—Ä —à—É–¥–∞–Ω...</div>';
  try {
    const s = await apiFetch(`/vice-dean/api/students/${id}`);
    const nb = s.total_absent_hours;
    const lim = 35;
    const nbCol = nb>=lim?'var(--red)':nb>=20?'var(--orange)':'var(--green)';
    $('mStuContent').innerHTML=`
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div style="grid-column:1/-1;display:flex;align-items:center;gap:14px;margin-bottom:6px">
          <div style="width:52px;height:52px;border-radius:50%;background:${nb>=lim?'rgba(239,68,68,.15)':'var(--s2)'};display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:${nb>=lim?'var(--red)':'var(--blue)'}">${s.full_name.charAt(0)}</div>
          <div>
            <div style="font-size:16px;font-weight:800">${s.full_name}</div>
            <div style="font-size:12px;color:var(--muted);margin-top:2px">${s.student_code} &bull; –ì—É—Ä”Ø“≥: ${s.group_number||'‚Äî'} &bull; ${s.course_year||'?'}-–∫—É—Ä—Å</div>
          </div>
          <div style="margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:28px;font-weight:800;color:${nbCol}">${nb}</div>
        </div>
        ${[
          ['–°–æ–ª–∏ —Ç–∞–≤–∞–ª–ª—É–¥', s.birth_year||'‚Äî'],
          ['“∂–æ–∏ —Ç–∞–≤–∞–ª–ª—É–¥', s.birth_place||'‚Äî'],
          ['–í–∏–ª–æ—è—Ç', s.region||'‚Äî'],
          ['–¢–µ–ª–µ—Ñ–æ–Ω–∏ –≤–æ–ª–∏–¥–∞–π–Ω', s.parent_phone||'‚Äî'],
          ['–°–æ–ª–∏ —à—É—Ä—É—ä–∏ —Ç–∞“≥—Å–∏–ª', s.study_start||'‚Äî'],
          ['–ù–ë —É–º—É–º”£', `<strong style="color:${nbCol}">${nb} —Å–æ–∞—Ç</strong>`],
        ].map(([l,v])=>`
          <div style="background:var(--s2);border-radius:9px;padding:10px 14px">
            <div style="font-size:10px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px">${l}</div>
            <div style="font-size:13px;font-weight:600">${v}</div>
          </div>
        `).join('')}
      </div>
    `;
  } catch(e){ $('mStuContent').innerHTML='<p style="color:var(--muted)">–•–∞—Ç–æ–≥”£</p>'; }
}

// ‚îÄ‚îÄ HIGH NB ‚îÄ‚îÄ
async function loadHighNb() {
  $('highNbBody').innerHTML = loadingRow(6);
  try {
    const students = await apiFetch('/vice-dean/api/students?high_nb=true');
    $('highNbCount').textContent = `${students.length} –Ω–∞—Ñ–∞—Ä`;
    if(!students.length){ $('highNbBody').innerHTML=emptyRow(6,'–î–æ–Ω–∏—à“∑”Ø –±–æ –ù–ë –±–∞–ª–∞–Ω–¥ —ë—Ñ—Ç –Ω–∞—à—É–¥'); return; }
    $('highNbBody').innerHTML = students.map((s,i)=>`<tr>
      <td style="color:var(--muted);font-size:11px">${i+1}</td>
      <td style="font-weight:600;cursor:pointer;color:var(--blue)" onclick="openStudent(${s.id})">${s.full_name}</td>
      <td>${s.group_number||'‚Äî'}</td>
      <td>${s.course_year||'?'}-–∫—É—Ä—Å</td>
      <td>${nbBadge(s.total_absences)}</td>
      <td style="font-size:12px;color:var(--muted)">${s.parent_phone||'‚Äî'}</td>
    </tr>`).join('');
  } catch(e){ toast('–•–∞—Ç–æ–≥”£','err'); }
}

// ‚îÄ‚îÄ CONSECUTIVE ABSENCE ‚îÄ‚îÄ
async function loadConsec() {
  $('consecBody').innerHTML = loadingRow(4);
  try {
    const students = await apiFetch('/vice-dean/api/students/consecutive-absence');
    if(!students.length){ $('consecBody').innerHTML=emptyRow(4,'“í–∞–π–±–∞—Ç–∏ –ø–∞–∏ “≥–∞–º —ë—Ñ—Ç –Ω–∞—à—É–¥'); return; }
    $('consecBody').innerHTML = students.map((s,i)=>`<tr>
      <td style="color:var(--muted);font-size:11px">${i+1}</td>
      <td style="font-weight:600;cursor:pointer;color:var(--blue)" onclick="openStudent(${s.id})">${s.full_name}</td>
      <td>${s.group||'‚Äî'}</td>
      <td>${nbBadge(s.total_absences)}</td>
    </tr>`).join('');
  } catch(e){ toast('–•–∞—Ç–æ–≥”£','err'); }
}

// ‚îÄ‚îÄ CURATORS ‚îÄ‚îÄ
async function loadCurators() {
  $('curatorsBody').innerHTML = loadingRow(7);
  try {
    const cs = await apiFetch('/vice-dean/api/curators');
    if(!cs.length){ $('curatorsBody').innerHTML=emptyRow(7,'–ö—É—Ä–∞—Ç–æ—Ä –Ω–µ—Å—Ç'); return; }
    $('curatorsBody').innerHTML = cs.map((c,i)=>`<tr>
      <td style="color:var(--muted);font-size:11px">${i+1}</td>
      <td style="font-weight:600">${c.full_name}</td>
      <td style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--muted)">${c.username}</td>
      <td>${c.group?`<span class="badge b-shift1">${c.group.number}</span>`:'<span style="color:var(--muted)">‚Äî</span>'}</td>
      <td style="font-size:12px">${c.phone||'‚Äî'}</td>
      <td style="font-size:12px">${c.department||'‚Äî'}</td>
      <td><button class="btn btn-ghost btn-sm" onclick="openCurModal(${c.id},'${c.full_name}','${c.department||''}','${c.phone||''}','${c.email||''}')">‚úèÔ∏è –¢–∞“≥—Ä–∏—Ä</button></td>
    </tr>`).join('');
  } catch(e){ toast('–•–∞—Ç–æ–≥”£','err'); }
}

function openCurModal(id, name='', dept='', phone='', email='') {
  $('mCurId').value = id||'';
  $('mCurTitle').textContent = id?'–ö—É—Ä–∞—Ç–æ—Ä—Ä–æ —Ç–∞“≥—Ä–∏—Ä –∫—É–Ω–µ–¥':'–ö—É—Ä–∞—Ç–æ—Ä –∏–ª–æ–≤–∞ –∫—É–Ω–µ–¥';
  $('mCurName').value=name; $('mCurDept').value=dept;
  $('mCurPhone').value=phone; $('mCurEmail').value=email;
  $('mCurUser').value='';
  $('mCurUGroup').style.display = id?'none':'block';
  $('mCurPwdNote').style.display = id?'none':'flex';
  openModal('mCurator');
}

async function submitCurator() {
  const id=$('mCurId').value;
  const fd=new FormData();
  fd.append('full_name',$('mCurName').value.trim());
  fd.append('department',$('mCurDept').value.trim());
  fd.append('phone',$('mCurPhone').value.trim());
  fd.append('email',$('mCurEmail').value.trim());
  if(!id){ fd.append('username',$('mCurUser').value.trim()); }
  if(!$('mCurName').value.trim()){ toast('–ù–æ–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥','err'); return; }
  if(!id && !$('mCurUser').value.trim()){ toast('–Æ–∑–µ—Ä–Ω–µ–π–º –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥','err'); return; }
  try {
    if(id){ await apiPost(`/vice-dean/api/curators/${id}`,fd,'PUT'); toast('–ö—É—Ä–∞—Ç–æ—Ä —Å–∞–±—Ç —à—É–¥'); }
    else { await apiPost('/vice-dean/api/curators',fd); toast('–ö—É—Ä–∞—Ç–æ—Ä –∏–ª–æ–≤–∞ —à—É–¥'); }
    closeModal('mCurator');
    loadCurators();
  } catch(e){ toast(e.message,'err'); }
}

// ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ
async function loadProfile() {
  try {
    const p = await apiFetch('/vice-dean/api/profile');
    $('pName').value=p.full_name||''; $('pPhone').value=p.phone||'';
    $('pEmail').value=p.email||''; $('pDept').value=p.department||'';
    $('pBirth').value=p.birth_year||'';
    $('sbName').textContent=p.full_name; $('sbAv').textContent=p.full_name.charAt(0);
  } catch(e){}
}

async function saveProfile(e) {
  e.preventDefault();
  const fd=new FormData();
  fd.append('full_name',$('pName').value);
  fd.append('phone',$('pPhone').value||'');
  fd.append('email',$('pEmail').value||'');
  fd.append('department',$('pDept').value||'');
  fd.append('birth_year',$('pBirth').value||'');
  try {
    const d=await apiPost('/vice-dean/api/profile',fd,'PUT');
    toast('–ü—Ä–æ—Ñ–∏–ª —Å–∞–±—Ç —à—É–¥');
    $('sbName').textContent=d.full_name; $('sbAv').textContent=d.full_name.charAt(0);
  } catch(e){ toast(e.message,'err'); }
}

// ‚îÄ‚îÄ CLOSE MODALS ON OVERLAY CLICK ‚îÄ‚îÄ
['mCurator','mGroup','mStudent'].forEach(id=>{
  $(id)?.addEventListener('click', function(e){ if(e.target===this) closeModal(id); });
});

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  loadOverview();
  // Sidebar user init
  const name = $('sbName')?.textContent;
  if(name) { $('sbAv').textContent=name.charAt(0); }
});
</script>
</body>
</html>